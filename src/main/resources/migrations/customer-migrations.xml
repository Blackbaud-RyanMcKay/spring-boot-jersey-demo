<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <property name="now" value="CURRENT_TIMESTAMP" dbms="oracle" />

    <changeSet logicalFilePath="path-independent" id="1" author="khutson" context="app_main">
        <createTable tableName="WEBFORM_REGISTRY_MIDWAY">
            <column name="WEBFORM_ID" type="NUMBER(11,0)">
                <constraints nullable="true"/>
            </column>
            <column name="NAME" type="VARCHAR2(128 BYTE)">
                <constraints nullable="true"/>
            </column>
            <column name="DESCRIPTION" type="VARCHAR2(1024 BYTE)">
                <constraints nullable="true"/>
            </column>
            <column name="URL" type="VARCHAR2(400 BYTE)">
                <constraints nullable="true"/>
            </column>
            <column name="TEST" type="NUMBER(1,0)">
                <constraints nullable="true"/>
            </column>
            <column name="SPECIAL_CASES" type="VARCHAR2(256 BYTE)">
                <constraints nullable="true"/>
            </column>
            <column name="FALLBACK_URL_ARGS" type="VARCHAR2(2000 BYTE)">
                <constraints nullable="true"/>
            </column>
            <column name="COMMIT_STATUS" type="VARCHAR2(20 BYTE)">
                <constraints nullable="true"/>
            </column>
            <column name="WEBFORM_TYPE" type="VARCHAR2(20 BYTE)">
                <constraints nullable="true"/>
            </column>
            <column name="THROTTLE_LIMIT" type="NUMBER(11,0)">
                <constraints nullable="true"/>
            </column>
            <!--http://forum.liquibase.org/topic/how-to-define-a-check-constraint
                summary : check constraints not supported, but can be done in a <sql> block?
            -->
            <!--CONSTRAINT "WEBFORM_REGISTRY_TYPE_CK" CHECK (webform_type IN ('convio', 'selenium', 'cwc')) ENABLE-->
        </createTable>
        <addPrimaryKey columnNames="WEBFORM_ID"
                       constraintName="WEBFORM_REGISTRY_MIDWAY_PK"
                       tableName="WEBFORM_REGISTRY_MIDWAY" />
        <addUniqueConstraint columnNames="URL"
                             constraintName="WEBFORM_UNIQ_URL_MIDWAY"
                             tableName="WEBFORM_REGISTRY_MIDWAY"/>
        <addDefaultValue columnName="WEBFORM_TYPE"
                         defaultValue="convio"
                         tableName="WEBFORM_REGISTRY_MIDWAY"/>
        <addDefaultValue columnName="TEST"
                         defaultValue="0"
                         tableName="WEBFORM_REGISTRY_MIDWAY"/>
        <addDefaultValue columnName="THROTTLE_LIMIT"
                         defaultValue="0"
                         tableName="WEBFORM_REGISTRY_MIDWAY"/>


        <createTable tableName="WEBFORM_TOPICS">
            <column name="WEBFORM_TOPIC_ID" type="NUMBER(*,0)">
                <constraints nullable="false"/>
            </column>
            <column name="WEBFORM_ID" type="NUMBER(*,0)">
                <constraints nullable="false"/>
            </column>
            <column name="TOPIC_VALUE" type="VARCHAR2(500 BYTE) ">
                <constraints nullable="false"/>
            </column>
            <column name="TOPIC_DISPLAY_NAME" type="VARCHAR2(500 BYTE) ">
                <constraints nullable="true"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="WEBFORM_TOPIC_ID"
                       constraintName="WEBFORM_TOPICS_PK"
                       tableName="WEBFORM_TOPICS" />
        <createIndex indexName="WEBFORM_TOPICS_WF_ID_IDX" tableName="WEBFORM_TOPICS">
            <column name="WEBFORM_ID"/>
        </createIndex>

        <createTable tableName="WP_CATEGORY">
            <column name="WP_CATEGORY_ID" type="NUMBER(*,0)">
                <constraints nullable="false"/>
            </column>
            <column name="CATEGORY_NAME" type="VARCHAR2(200 BYTE)">
                <constraints nullable="false"/>
            </column>
            <column name="LAST_UPDATE" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="COMMIT_STATUS" type="VARCHAR2(12 BYTE)">
                <constraints nullable="false"/>
            </column>
            <!--CONSTRAINT "WP_CATEGORY_STATUS_CK" CHECK (commit_status in ('COMMITTED', 'UNCOMMITTED')) ENABLE-->
        </createTable>
        <addPrimaryKey columnNames="WP_CATEGORY_ID"
                       constraintName="WP_CATEGORY_PK"
                       tableName="WP_CATEGORY" />
        <addDefaultValue columnDataType="DATE"
                         columnName="LAST_UPDATE"
                         defaultValueDate="sysdate"
                         tableName="WP_CATEGORY"/>
        <addDefaultValue columnName="COMMIT_STATUS"
                         defaultValue="UNCOMMITTED"
                         tableName="WP_CATEGORY"/>

        <createTable tableName="WP_CATEGORY_MAP_REP_ID">
            <column name="REP_ID" type="NUMBER(*,0)">
                <constraints nullable="false"/>
            </column>
            <column name="WP_CATEGORY_ID" type="NUMBER(*,0)">
                <constraints nullable="false"/>
            </column>
            <column name="CHOICE_VALUE" type="VARCHAR2(500 BYTE)">
                <constraints nullable="false"/>
            </column>
            <column name="LAST_UPDATE" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="REP_ID, WP_CATEGORY_ID"
                       constraintName="WP_CAT_MAP_REP_ID_PK"
                       tableName="WP_CATEGORY_MAP_REP_ID" />
        <addDefaultValue columnDataType="DATE"
                         columnName="LAST_UPDATE"
                         defaultValueDate="sysdate"
                         tableName="WP_CATEGORY_MAP_REP_ID"/>

        <createTable tableName="WP_CATEGORY_MAP_WEBFORM_ID">
            <column name="WEBFORM_ID" type="NUMBER(*,0)">
                <constraints nullable="false"/>
            </column>
            <column name="WP_CATEGORY_ID" type="NUMBER(*,0)">
                <constraints nullable="false"/>
            </column>
            <column name="CHOICE_VALUE" type="VARCHAR2(500 BYTE)">
                <constraints nullable="false"/>
            </column>
            <column name="LAST_UPDATE" type="DATE">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="WEBFORM_ID, WP_CATEGORY_ID"
                       constraintName="WP_CAT_MAP_WEBFORM_ID_PK"
                       tableName="WP_CATEGORY_MAP_WEBFORM_ID" />
        <addDefaultValue columnDataType="DATE"
                         columnName="LAST_UPDATE"
                         defaultValueDate="sysdate"
                         tableName="WP_CATEGORY_MAP_WEBFORM_ID"/>

    </changeSet>

</databaseChangeLog>
